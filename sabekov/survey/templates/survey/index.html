{% extends 'base/base.html' %}

{% block window_title %}Sites Overview{% endblock %}

{% block content %}
<div class="container">
{% if perms.survey.can_review %}
<ul class="nav nav-pills">
  <li class="active"><a href="{% url 'survey:site_overview' checklist.id %}">Overview</a></li>
  <li><a href="{% url 'survey:summary-list' checklist.id %}">Summary</a></li>
  <li><a href="{% url 'survey:summary-by-user-list' checklist.id %}">Summary by User</a></li>
</ul>
{% endif %}

<h2>Sites Overview</h2>

<form action="{% url 'survey:site_overview' checklist.id %}" method="post"
    class="form-inline">
<div class="form-group">
{{ cl_form }}
</div>
{% csrf_token %}
<input type="submit" value="Ok" class=""/>
</form>

{% if site_list %}
<table class="table table-striped">
 <thead>
  <tr>
     <th class="col-md-6">Site</th>
     <th class="col-md-2">Est. Progress</th>
     <th class="col-md-4">Status</th>
  </tr>
 </thead>
 <tbody>
 {% for site, evaluation in site_list %}
  <tr>
     <td><a href="{% url 'survey:evaluate' checklist.id site.id %}">{{ site.name }}</a></td>
     <td>
       {% with prog=evaluation.estimate_progress %}
       <div class="progress">
         <div class="progress-bar" role="progressbar" aria-valuenow="{{ prog }}" aria-valuemin="0" aria-valuemax="100" style="width:{{ prog }}%">
           <span class="sr-only">{{ prog }}%</span>
        </div>
       </div>
       {% endwith %}
     </td>
     <td>
       {% if evaluation %}<span class="label label-warning">Discussions <span class="badge">{{ evaluation.count_discussions }}</span></span>&nbsp;{% endif %}
       {% if evaluation %}<span class="label label-info">Revisions <span class="badge">{{ evaluation.count_revisions }}</span></span>&nbsp;{% endif %}
       {% if evaluation and evaluation.finished %}<span class="label label-success">Finished</span>&nbsp;{% endif %}
    </td>
  </tr>
 {% endfor %}
 </tbody>
</table>
{% else %}
<div class="alert alert-info">No sites are available.</div>
{% endif %}
</div>
{% endblock %}
